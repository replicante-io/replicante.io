<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Rolling Upgrades · Replicante Core Manual</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;No software is perfect and few are ever complete.&lt;/p&gt;
"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Rolling Upgrades · Replicante Core Manual"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.replicante.io/docs/manual/index.html"/><meta property="og:description" content="&lt;p&gt;No software is perfect and few are ever complete.&lt;/p&gt;
"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/docs/manual/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/docs/manual/css/main.css"/><script src="/docs/manual/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docs/manual/"><h2 class="headerTitle">Replicante Core Manual</h2></a><a href="/docs/manual/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/manual/docs/next/intro" target="_self">Docs</a></li><li class=""><a href="https://www.replicante.io" target="_self">Website</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Upgrades</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">First steps</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/quick-start">Quick Start</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/architecture">Architecture Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Administration</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/admin-deps">Dependencies</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/admin-install">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/admin-config">Configuration</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/features">Features Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/features-discovery">Agent Discovery</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/features-events">Events</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/features-webui">WebUI</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/features-introspection">Introspection</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Security</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/security">Security Considerations</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/security-transport">Agent Transports</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Upgrades</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/docs/manual/docs/next/upgrades-rolling">Rolling Upgrades</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/upgrades-versions">Version Compatibility</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/upgrades-notes">Upgrade Notes</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/upgrades-changelog">Change Log</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">replictl</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/replictl-intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/replictl-check">replictl check</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/replictl-versions">replictl versions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/api">API Reference</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/api-monitoring">Monitoring</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Rolling Upgrades</h1></header><article><div><span><p>No software is perfect and few are ever complete.
Updates are, or should be, part of the day to day operations.
This document describes the steps you can follow to upgrade Replicante without service interruption.</p>
<p><strong>Note</strong>: this document does NOT describe how to update replicante's dependencies.
You should take care to keep them up to date as well.</p>
<p>The upgrade path relies on Replicante high availability features to avoid loss of service.
Nodes are updated one at a time, upgrading them between compatible versions.
Once all nodes are up to date and restarted the upgrade is complete.</p>
<ol>
<li>Read the <a href="/docs/manual/docs/next/upgrades-notes">release notes</a> for any special consideration for the version you are upgrading to.</li>
<li>Obtain a copy of the code to update to (see the <a href="/docs/manual/docs/next/admin-install">install</a> section).</li>
<li>Test configuration and store contents compatibility (see <a href="/docs/manual/docs/next/replictl-check"><code>replictl check upgrade</code></a>).</li>
<li>For each Replicante server:</li>
<li><a href="/docs/manual/docs/next/admin-install">Install</a> the new binary.</li>
<li>Restart the process on the node.</li>
<li>Check the logs to ensure everything works as expect.</li>
</ol>
<p>Once the upgrade is complete you should review the configuration to enable new options
and disable any deprecated features.</p>
<h2><a class="anchor" aria-hidden="true" id="changes-to-data-schema"></a><a href="#changes-to-data-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Changes to data schema</h2>
<p>Any software that persist data needs to deal with changes to the schema as the software evolves.
Replicante tries to avoid the need for migrations by gradually rolling out changes to the data.</p>
<p>When the data schema needs to change:</p>
<ol>
<li>A minor version is released to introduce the changes as optional:</li>
</ol>
<pre><code class="hljs">* New attributes are added and always set but expected to be missing.
* Deprecated attributes are no longer used but still set.
</code></pre>
<ol start="2">
<li>As clusters are updated collected and generated data will have the new schema.</li>
<li>A major version is released expecting the data to have the new schema:</li>
</ol>
<pre><code class="hljs">* New attributes are no longer optional and decoding data without them fails.
* Deprecated attributes are no longer used or set.
</code></pre>
<blockquote class="info">
<p><strong>Upgrading to major releases</strong></p>
<p>Always run the latest minor release before upgrades to the next major release.</p>
<p>The approach above works because replicante expires historical data and refreshes monitoring data.
You may need to run the latest minor release until all data items are expired or refreshed.
The <a href="/docs/manual/docs/next/replictl-check"><code>replictl check upgrade</code></a> command can scan your dataset
to ensure all items are compatible with the new format.</p>
</blockquote>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/manual/docs/next/security-transport"><span class="arrow-prev">← </span><span>Agent Transports</span></a><a class="docs-next button" href="/docs/manual/docs/next/upgrades-versions"><span>Version Compatibility</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#changes-to-data-schema">Changes to data schema</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap" style="text-align:center"><div><h5>Docs</h5><a href="/docs/manual/docs/quick-start">Quick Start</a><a href="/docs/manual/docs/features">Features</a><a href="/docs/manual/docs/api">API Reference</a></div><div><h5>Community</h5><a href="https://github.com/replicante-io">GitHub Organisation</a><a href="https://www.replicante.io/">Official Website</a></div></section><section class="copyright">Copyright © 2019 Stefano Pogliani</section></footer></div></body></html>