<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Flexible Deployment · Replicante Core Manual</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Replicante Core comes as a single binary with configurable components.&lt;/p&gt;
"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Flexible Deployment · Replicante Core Manual"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.replicante.io/docs/manual/index.html"/><meta property="og:description" content="&lt;p&gt;Replicante Core comes as a single binary with configurable components.&lt;/p&gt;
"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/docs/manual/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/docs/manual/css/main.css"/><script src="/docs/manual/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docs/manual/"><h2 class="headerTitle">Replicante Core Manual</h2></a><a href="/docs/manual/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/manual/docs/next/intro" target="_self">Docs</a></li><li class=""><a href="https://www.replicante.io" target="_self">Website</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Administration</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">First steps</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/quick-start">Quick Start</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/architecture">Architecture Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Administration</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/admin-deps">Dependencies</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/admin-install">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/admin-config">Configuration</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/manual/docs/next/admin-flexible-deployment">Flexible Deployment</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/admin-tasks">Tasks subsystem</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/features">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/features-discovery">Agent Discovery</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/features-events">Events</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/features-webui">WebUI</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/features-introspection">Introspection</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Security</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/security">Security Considerations</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/security-transport">Agent Transports</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Upgrades</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/upgrades-rolling">Rolling Upgrades</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/upgrades-versions">Version Compatibility</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/upgrades-notes">Upgrade Notes</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/upgrades-changelog">Change Log</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">replictl</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/replictl-intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/replictl-check">replictl check</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/replictl-coordinator">replictl coordinator</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/replictl-versions">replictl versions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/api">API Reference</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/api-monitoring">Monitoring</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Scaling</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/scaling">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/scaling-store">Primary Store</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/scaling-tasks">Task Queues</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/scaling-events">Event streams</a></li><li class="navListItem"><a class="navItem" href="/docs/manual/docs/next/scaling-coordinator">Coordinator</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Flexible Deployment</h1></header><article><div><span><p>Replicante Core comes as a single binary with configurable components.</p>
<p>Some components provide optional functionality.
The <code>grafana</code> component for example only provides the endpoints used for
<a href="/docs/manual/docs/next/features-events#grafana-annotations">Grafana annotations</a> and can be disabled
if the functionality provided is not useful to the user.</p>
<p>By default, all components are enabled on all nodes.
The exception are components providing experimental or deprecated functionality.</p>
<h2><a class="anchor" aria-hidden="true" id="uniform-deployment"></a><a href="#uniform-deployment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uniform deployment</h2>
<p>As a result of these defaults, Replicante Core runs as a <em>uniform deployment</em>:
each node is equivalent to all other nodes and capable of performing the same functions.</p>
<p>The main advantage of a uniform deployment is simplicity:</p>
<ul>
<li>Each node is the same as all others.</li>
<li>The system is simpler to understand: no &quot;who does what?&quot; scenarios.</li>
</ul>
<p>This simplicity comes at a cost:</p>
<ul>
<li>One component miss-behaving on a node can impact all other components on the same node.</li>
<li>Expensive API requests can impact system functionality and system functionality can impact API requests.</li>
<li>Scaling the system is less granular: the bottleneck sets the &quot;size&quot; for all components.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="dedicated-api-servers"></a><a href="#dedicated-api-servers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dedicated API servers</h2>
<p>Another very common deployment configuration is based on separating the API servers from
other components in the system.
This protects the system from expensive API requests and ensures that API requests are not
effected by expensive system operations.</p>
<p>To deploy dedicated API servers two &quot;roles&quot; are created by using different configurations
for each role.
Most options are the same across both roles so only the different parts are shown here.</p>
<p>For the &quot;API server&quot; role use the following configuration:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">components:</span>
<span class="hljs-attr">  _default:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># Disable all components not explicitly listed.</span>
<span class="hljs-attr">  grafana:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># Optionally enable the grafana annotations API too.</span>
<span class="hljs-attr">  webui:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>For the &quot;system server&quot; role, the one running all non-API components, use the following configuration:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">components:</span>
<span class="hljs-attr">  _default:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># Enable all components not explicitly listed.</span>
<span class="hljs-attr">  grafana:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># Disable grafana annotations API.</span>
<span class="hljs-attr">  webui:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># Disable the WebUI API.</span>
</code></pre>
<p>While this approach isolates API requests from all other system functionality
it does not address any of the other limitations of a uniform deployment.</p>
<h2><a class="anchor" aria-hidden="true" id="dedicated-everything"></a><a href="#dedicated-everything" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dedicated everything</h2>
<p>The approach of dedicated roles can be extended from API vs everything else
to the extreme of a role for each component.</p>
<p>It is time to mention that replicante also has a <code>workers</code> component that runs asynchronous tasks.
To pick which tasks a node should be working on the <code>task_workers.*</code> configuration options
can be used in a similar way to <code>components.*</code>.</p>
<p>To define a role for a component use the following configuration snippet:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">components:</span>
<span class="hljs-attr">  _default:</span> <span class="hljs-literal">false</span>
  <span class="hljs-string">&lt;COMPONENT&gt;:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>For task worker roles use the following configuration snippet:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">components:</span>
<span class="hljs-attr">  _default:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">  workers:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">task_workers:</span>
<span class="hljs-attr">  _default:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># Disable processing of tasks not explicitly enabled.</span>
  <span class="hljs-string">&lt;TASK_TYPE&gt;:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>While such a diverse deployment requires a bit more effort to manage it does have several advantages:</p>
<ul>
<li>Each component and/or task worker can scale independently as needed.</li>
<li>Components are isolated from each other (through the user's preferred process isolation solution).</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="to-each-their-own"></a><a href="#to-each-their-own" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>To each their own</h2>
<p>From the configuration snippets above is should be clear that a spectrum of deployments is possible.
Users are free to configure different nodes to best fit their needs.</p>
<p>To ensure that all required components are configured and available somewhere in the cluster
replicante exposes metrics for which components are enabled on each node.</p>
<p>The following prometheus queries can aid operators monitor components and task workers across
all nodes in a Replicante Core cluster:</p>
<ul>
<li><code>replicore_components_enabled{type=&quot;required&quot;}</code>: should be <code>&gt;= 1</code> for each component.</li>
<li><code>replicore_workers_enabled</code>: should be <code>&gt;= 1</code> for each worker.</li>
</ul>
<p>There is also a query to count optional components: <code>replicore_components_enabled{type=&quot;optional&quot;}</code>.
Users that would like to make use of optional features should ensure that components providing
such features are available somewhere in the cluster.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/manual/docs/next/admin-config"><span class="arrow-prev">← </span><span>Configuration</span></a><a class="docs-next button" href="/docs/manual/docs/next/admin-tasks"><span>Tasks subsystem</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#uniform-deployment">Uniform deployment</a></li><li><a href="#dedicated-api-servers">Dedicated API servers</a></li><li><a href="#dedicated-everything">Dedicated everything</a></li><li><a href="#to-each-their-own">To each their own</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap" style="text-align:center"><div><h5>Docs</h5><a href="/docs/manual/docs/quick-start">Quick Start</a><a href="/docs/manual/docs/features">Features</a><a href="/docs/manual/docs/api">API Reference</a></div><div><h5>Community</h5><a href="https://github.com/replicante-io">GitHub Organisation</a><a href="https://www.replicante.io/">Official Website</a></div></section><section class="copyright">Copyright © 2019 Stefano Pogliani</section></footer></div></body></html>