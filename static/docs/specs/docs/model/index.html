<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>The Datastore Model · Protocol and Model Specifications</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;blockquote class=&quot;warning&quot;&gt;"/><meta name="docsearch:version" content="0.4.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="The Datastore Model · Protocol and Model Specifications"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.replicante.io/docs/specs/"/><meta property="og:description" content="&lt;blockquote class=&quot;warning&quot;&gt;"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/docs/specs/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/docs/specs/js/scrollSpy.js"></script><link rel="stylesheet" href="/docs/specs/css/main.css"/><script src="/docs/specs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docs/specs/"><h2 class="headerTitle">Protocol and Model Specifications</h2></a><a href="/docs/specs/versions"><h3>0.4.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/specs/docs/intro" target="_self">Docs</a></li><li class=""><a href="https://www.replicante.io" target="_self">Website</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>The Datastore Model</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/specs/docs/intro">Introduction</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">The Datastore Model</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/docs/specs/docs/model">The Datastore Model</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Examples: mapping DBs to the Model</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/specs/docs/example">Examples: mapping DBs to the Model</a></li><li class="navListItem"><a class="navItem" href="/docs/specs/docs/example-kafka">Kafka</a></li><li class="navListItem"><a class="navItem" href="/docs/specs/docs/example-mongodb">MongoDB</a></li><li class="navListItem"><a class="navItem" href="/docs/specs/docs/example-zookeeper">Zookeeper</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">The Agent Protocol</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/specs/docs/agent">The Agent Protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/specs/docs/agent-info">Agent Information</a></li><li class="navListItem"><a class="navItem" href="/docs/specs/docs/agent-shards">Shards Information</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Model ChangeLog</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/specs/docs/changelog">Model Change Log</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">The Datastore Model</h1></header><article><div><span><blockquote class="warning">
<p><strong>Alpha state disclaimer</strong></p>
<p>The model defined below is in early development cycle
and is subject to (potentially breaking) change.</p>
</blockquote>
<p>Any (collection of) software that fulfils the requirements and expectations
of the model defined in this document is considered a datastore.</p>
<p>The difficulty in defining a model is to find the balance
between generality and specificity:</p>
<ul>
<li>The model should be general so it does not impose restrictions on the
datastores that want to be supported (or on us to support datastores).</li>
<li>The model also should be specific enough so that it can be reliably operated on.</li>
</ul>
<p>This aims of the model are:</p>
<ul>
<li>To determine which software can be modelled and how.</li>
<li>To implement agents that sit between the datastore and the central system.</li>
<li>To detail what information is available and what actions can be performed by the agents.</li>
<li>To determine what features can be built on top of this standardised layer.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="administration"></a><a href="#administration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Administration</h2>
<p>The datastore MUST provide the following administration information:</p>
<ul>
<li>A cluster ID shared by all nodes.</li>
<li>A cluster-unique name for the node.</li>
<li>Version information.</li>
</ul>
<p>The datastore MAY provide the following administration information:</p>
<ul>
<li>An operator friendly display name for the cluster.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="clustering"></a><a href="#clustering" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Clustering</h2>
<p>The datastore MUST support clustering by running a process on one or more (virtual or physical)
machine.
Each process in the cluster is a node.</p>
<p>Note that there is no requirement for the process be the same everywere in the cluster
(same applies to how nodes are configured).
This allows the cluster to have heterogeneous components as long as they all follow the model.</p>
<h2><a class="anchor" aria-hidden="true" id="sharding"></a><a href="#sharding" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sharding</h2>
<p>The datastore MUST organize the data in one or more shard.
Shards are independent units of data, each with their own primary and secondaries nodes.</p>
<p>All datastores have at least one shard.<br>
For datastores that do not support sharding, the entire dataset can be seen as a single shard.</p>
<p>For each shard in the cluster the datastore MUST provide the following information:</p>
<ul>
<li>A shard ID.</li>
</ul>
<p>Each node in the cluster SHOULD provide the following information for each:</p>
<ul>
<li>An indicator of when the last write operation happened (commit offset):
<ul>
<li>A commit offset unit (i.e, seconds, commits, ...).</li>
<li>A commit offset value (as a 64-bits integer).</li>
</ul></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="replication"></a><a href="#replication" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Replication</h2>
<p>The datastore MUST support a primary/secondaries replication system.
This means that each shard at any given time has only primary node with zero or more
secondary nodes that replicate the data from another node.</p>
<p>Each node in the cluster MUST provide the following information:</p>
<ul>
<li>Which shards are on the node.</li>
<li>For each shard, what the role on the node is (i.e, primary, secondary).</li>
</ul>
<p>Some details about replication require the cluster to be healthy enough to report such data.
Such details may also be expensive to compute or, worse, require connections to non-local nodes.</p>
<p>This information should be provided whenever possible as long as:</p>
<ul>
<li>Computing the information only requires local information
(i.e, it does not require connections to other nodes).</li>
<li>The information can be computed relatively efficiently.</li>
</ul>
<p>Each node in the cluster SHOULD provide the following information:</p>
<ul>
<li>For each non-primary shard, a replication lag:
<ul>
<li>The replication lag unit (i.e, seconds, commits, etc ...).</li>
<li>The replication lag value.</li>
<li>It is NOT required for the unit to be the same as the commit offset but it is encouraged.</li>
</ul></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/specs/docs/intro"><span class="arrow-prev">← </span><span>Introduction</span></a><a class="docs-next button" href="/docs/specs/docs/example"><span>Examples: mapping DBs to the Model</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#administration">Administration</a></li><li><a href="#clustering">Clustering</a></li><li><a href="#sharding">Sharding</a></li><li><a href="#replication">Replication</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap" style="text-align:center"><div><h5>Docs</h5><a href="/docs/specs/docs/intro">Introduction</a><a href="/docs/specs/docs/model">The Datastore Model</a><a href="/docs/specs/docs/agent">The Agent Protocol</a><a href="/docs/specs/docs/changelog">Model Change Log</a></div><div><h5>Community</h5><a href="https://github.com/replicante-io">GitHub Organisation</a><a href="https://www.replicante.io/">Official Website</a></div></section><section class="copyright">Copyright © 2019 Stefano Pogliani</section></footer></div></body></html>