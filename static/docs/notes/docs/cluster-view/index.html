<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>The cluster view · Developers Notebook</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="There is a fundamental limit to observation of a distributed system: it is not possible to have a"/><meta name="docsearch:version" content="0.4.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="The cluster view · Developers Notebook"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.replicante.io/docs/notes/"/><meta property="og:description" content="There is a fundamental limit to observation of a distributed system: it is not possible to have a"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/docs/notes/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/docs/notes/js/scrollSpy.js"></script><link rel="stylesheet" href="/docs/notes/css/main.css"/><script src="/docs/notes/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docs/notes/"><h2 class="headerTitle">Developers Notebook</h2></a><a href="/docs/notes/versions"><h3>0.4.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/notes/docs/architecture" target="_self">Docs</a></li><li class=""><a href="https://www.replicante.io" target="_self">Website</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Architectural Notes</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Architectural Notes</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/notes/docs/architecture">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/from-discovery-to-events">From agent discovery to cluster events</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/notes/docs/cluster-view">The cluster view</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/data-storage-format">Data storage format</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/scaling">Scaling</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/coordinator">Distributed Coordination</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/archnotes-fail-locks">Failure Modes: Locks</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Premature Optimisations</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/notes/docs/optimizations">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/concurrent-agent-fetch">Concurrent Agent Fetches</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/dynamic-config">Dynamic configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/kafka-consumer">Rewrite Kafka Consumer</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/kafka-scale">Online Kafka stream resize</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/layered-config">Layered Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/lock-validation-writes">Lock validation before writes</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/multi-cache">Multi-cache backend</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/stream-batches">Stream Batches</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/zookeeper-elections">Rewrite Zookeeper Elections</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Dreamland</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/notes/docs/dreamland">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/actions">The Actions System</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/auditing">Auditing System</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/best-checklists">Best practices checklists</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/cluster-groups">Cluster groups</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/cluster-playbooks">Cluster coordinated playbooks</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/cluster-tags">Cluster tags</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/core-bootstrap">Replicante bootstrapping procedure</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/failure-trigger-recognition">Failure triggers detection</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/generic-backends">Generic backends interface</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/metrics-insight">Metrics based insight</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/migration-backend">Store migration backend</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/multiple-transports">Multiple agent transports</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/node-events">Node events collection</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/organisations">Organisations and Teams</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/provisioners">Provisioning integrations</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/rate-limits">Rate Limits</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/read-only-mode">Read only mode</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/replication-window">Replication window metrics and re-sync times</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/resync-webui">Resyncable WebUI application</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/secrets">Secrets manager integrations</a></li><li class="navListItem"><a class="navItem" href="/docs/notes/docs/tls-rotation">TLS certificate rotation</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">The cluster view</h1></header><article><div><span><p>There is a fundamental limit to observation of a distributed system: it is not possible to have a
consistent, point in time, view of the entire system.
Such a view would also provide a false illusion: by the time we do anything with it the state
of the system would have changed.</p>
<p>Replicante accepts the intrinsic unreliability of the cluster view so it can rely on it
while not falling for the trap that &quot;we know what the state of the system is&quot;.</p>
<p>This means:</p>
<ul>
<li>Aggregations are considered approximate views and need to be checked or confirmed
(most likely by observing the faulty state for at least two monitoring cycles).</li>
<li>Actions performed by any agent on any node will have preconditions.
Agents will check the preconditions and refuse to perform actions based on stale or incorrect views.</li>
</ul>
<p>On the upside:</p>
<ul>
<li>The approximate views can be generated even though exact ones can't.</li>
<li>The generation process can lazily load data about each node, avoiding unreasonable
resource requirements in the face of large clusters.</li>
<li>The illusion of (certain) transactions is dropped before it begins (we could not rely
on them across monitor, process, action scheduling, action execution as the cluster
changes even when our view on it is transactional).</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/notes/docs/from-discovery-to-events"><span class="arrow-prev">← </span><span>Previous</span></a><a class="docs-next button" href="/docs/notes/docs/data-storage-format"><span>Next</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap" style="text-align:center"><div><h5>Docs</h5><a href="/docs/notes/docs/architecture">Architectural Notes</a><a href="/docs/notes/docs/optimizations">Premature Optimisations</a><a href="/docs/notes/docs/dreamland">Dreamland</a></div><div><h5>Community</h5><a href="https://github.com/replicante-io">GitHub Organisation</a><a href="https://www.replicante.io/">Official Website</a></div></section><section class="copyright">Copyright © 2019 Stefano Pogliani</section></footer></div></body></html>